import { Injectable } from '@angular/core';

@Injectable({
	providedIn: 'root'
})
export class UacodeService {
	constructor() {}

	getExample(id: number): string {
		const command = this.commands.find((cmd) => cmd.id === id);

		return command ? command.example : ' ';
	}

	getQuestion(id: number): string {
		const command = this.commands.find((cmd) => cmd.id === id);

		return command ? command.question : ' ';
	}

	translate(code: string): string {
		// Step 1: Build the translations map
		const translations: Record<string, string> = {};

		this.commands.forEach((cmd) => {
			translations[cmd.name] = cmd.execute;
		});

		// Step 2: Logical operators
		const logicalOperators: Record<string, string> = {
			ВІРНО: 'true',
			НЕВІРНО: 'false',
			' ТА ': ' && ',
			' АБО ': ' || '
		};

		// Step 3: Split code into parts - code vs string literals
		const stringRegex = /(["'`])((?:\\.|(?!\1).)*?)\1/g;
		const placeholders: string[] = [];

		// Replace string literals with placeholders
		let protectedCode = code.replace(stringRegex, (match) => {
			const index = placeholders.length;
			placeholders.push(match);
			return `__STR_PLACEHOLDER_${index}__`;
		});

		// Step 4: Translate only non-string parts
		for (const [uaCmd, jsCmd] of Object.entries(translations)) {
			protectedCode = protectedCode.split(uaCmd).join(jsCmd);
		}

		for (const [uaCmd, jsCmd] of Object.entries(logicalOperators)) {
			protectedCode = protectedCode.split(uaCmd).join(jsCmd);
		}

		// Step 5: Restore string literals
		const finalCode = protectedCode
			.replace(/__STR_PLACEHOLDER_(\d+)__/g, (_, i) => placeholders[+i])
			.split('elseif')
			.join('else if');

		return finalCode.trim();
	}

	commands = [
		{
			id: 1,
			name: 'Друк',
			execute: 'print',
			example: "Друк('Світ');",
			question: "Друк('Україна');"
		},
		{
			id: 2,
			name: 'Змінна',
			execute: 'var',
			example: "Змінна назва = 'Ніка';\n\nДрук('Мене звати: ' + назва);",
			question: "Змінна назва = 'Іван';\n\nДрук('Мене звати: ' + назва);"
		},
		{
			id: 3,
			name: 'Константа',
			execute: 'const',
			example: "Константа рік = 2024;\n\nДрук('Цей рік: ' + рік);",
			question: "Константа рік = 2025;\n\nДрук('Цей рік: ' + рік);"
		},
		{
			id: 4,
			name: 'Якщо',
			execute: 'if',
			example: "Якщо (5 > 4) {\n  Друк('Це працює!');\n}",
			question: "Якщо (8 < 10) {\n  Друк('Це також працює!');\n}"
		},
		{
			id: 5,
			name: 'Інакше',
			execute: 'else',
			example:
				"Якщо (10 < 5 ТА 10 > 5) {\n  Друк('Обидві умови істинні');\n} Інакше {\n  Друк('Усі умови хибні');\n}",
			question:
				"Якщо (10 > 3 ТА 10 > 5) {\n  Друк('Обидві умови істинні');\n} Інакше {\n  Друк('Усі умови хибні');\n}"
		},
		{
			id: 6,
			name: 'ІнакшеЯкщо',
			execute: 'else if',
			example:
				"Якщо (10 < 5 ТА 10 > 5) {\n  Друк('Обидві умови істинні');\n} ІнакшеЯкщо (10 < 5 АБО 10 > 5) {\n  Друк('Одна з умов істинна');\n}",
			question:
				"Якщо (10 > 3 ТА 3 > 1) {\n  Друк('Обидві умови істинні');\n} ІнакшеЯкщо (10 < 15 АБО 10 < 3) {\n  Друк('Одна з умов істинна');\n}"
		},
		{
			id: 7,
			name: 'Поверни',
			execute: 'return',
			example:
				"Якщо (10 > 5) {\n  Поверни 'Готово';\n}\n\nДрук('Цей рядок не виконається');",
			question:
				"Якщо (10 < 5) {\n  Поверни 'Завершено';\n}\n\nДрук('Цей рядок виконається');"
		},
		{
			id: 8,
			name: 'Поки',
			execute: 'while',
			example:
				"Функція рахувати(лічильник) {\n  Поки (лічильник > 0) {\n    Друк('Лічильник: ' + лічильник);\n\n    лічильник--;\n  }\n}\n\nрахувати(5);",
			question:
				"Функція рахувати(лічильник) {\n  Поки (лічильник > 0) {\n    Друк('Лічильник: ' + лічильник);\n\n    лічильник--;\n  }\n}\n\nрахувати(3);"
		},
		{
			id: 9,
			name: 'Для',
			execute: 'for',
			example:
				"Для (Змінна i = 0; i < 5; i++) {\n  Друк('Крок ' + i);\n}",
			question:
				"Для (Змінна i = 0; i < 3; i++) {\n  Друк('Крок ' + i);\n}"
		},
		{
			id: 10,
			name: 'Перервати',
			execute: 'break',
			example:
				"Для (Змінна i = 0; i < 5; i++) {\n  Якщо (i === 3) {\n    Перервати;\n  }\n\n  Друк('i: ' + i);\n}",
			question:
				"Для (Змінна i = 0; i < 3; i++) {\n  Якщо (i === 3) {\n    Перервати;\n  }\n\n  Друк('i: ' + i);\n}"
		},
		{
			id: 11,
			name: 'Пропустити',
			execute: 'continue',
			example:
				"Для (Змінна i = 0; i < 5; i++) {\n  Якщо (i === 2) {\n    Пропустити;\n  }\n\n  Друк('Крок: ' + i);\n}",
			question:
				"Для (Змінна i = 0; i < 3; i++) {\n  Якщо (i === 2) {\n    Пропустити;\n  }\n\n  Друк('Крок: ' + i);\n}"
		},
		{
			id: 12,
			name: 'Функція',
			execute: 'function',
			example:
				"Функція привітання(імя) {\n  Друк('Привіт, ' + імя + '!');\n}\n\nпривітання('Ніка');",
			question:
				"Функція привітання(імя) {\n  Друк('Привіт, ' + імя + '!');\n}\n\nпривітання('Іван');"
		},
		{
			id: 13,
			name: 'Попередження',
			execute: 'alert',
			example: "Попередження('Привіт, це повідомлення для тебе!');",
			question: "Попередження('Привіт, це повідомлення для тебе!');"
		},
		{
			id: 14,
			name: 'ВипадковеЧисло',
			execute: 'Math.random',
			example:
				"Змінна випадкове = ВипадковеЧисло();\n\nДрук('Випадкове число: ' + випадкове);",
			question:
				"Змінна випадкове = ВипадковеЧисло();\n\nДрук('Випадкове число: ' + випадкове);"
		},
		{
			id: 15,
			name: 'Округлити',
			execute: 'Math.round',
			example: "Друк('Округлити 4.6: ' + Округлити(4.6));",
			question: "Друк('Округлити 4.6: ' + Округлити(4.6));"
		},
		{
			id: 16,
			name: 'ДоМеньшогоЦілого',
			execute: 'Math.floor',
			example:
				"Друк('До меньшого цілого 4.9: ' + ДоМеньшогоЦілого(4.9));",
			question:
				"Друк('До меньшого цілого 4.9: ' + ДоМеньшогоЦілого(4.9));"
		},
		{
			id: 17,
			name: 'ДоБільшогоЦілого',
			execute: 'Math.ceil',
			example:
				"Друк('До більшого цілого 4.1: ' + ДоБільшогоЦілого(4.1));",
			question:
				"Друк('До більшого цілого 4.1: ' + ДоБільшогоЦілого(4.1));"
		},
		{
			id: 18,
			name: 'Мінімум',
			execute: 'Math.min',
			example: "Друк('Мінімум з 3 і 8: ' + Мінімум(3, 8));",
			question: "Друк('Мінімум з 3 і 8: ' + Мінімум(3, 8));"
		},
		{
			id: 19,
			name: 'Максимум',
			execute: 'Math.max',
			example: "Друк('Максимум з 3 і 8: ' + Максимум(3, 8));",
			question: "Друк('Максимум з 3 і 8: ' + Максимум(3, 8));"
		},
		{
			id: 20,
			name: 'Корінь',
			execute: 'Math.sqrt',
			example: "Друк('Корінь з 25: ' + Корінь(25));",
			question: "Друк('Корінь з 23: ' + Корінь(25));"
		},
		{
			id: 21,
			name: 'Степінь',
			execute: 'Math.pow',
			example: "Друк('2 в степені 3: ' + Степінь(2, 3));",
			question: "Друк('2 в степені 3: ' + Степінь(2, 3));"
		},
		{
			id: 22,
			name: 'Дата',
			execute: 'new Date',
			example: "Друк('Сьогоднішня дата: ' + Дата());",
			question: "Друк('Сьогоднішня дата: ' + Дата());"
		},
		{
			id: 23,
			name: 'Зараз',
			execute: 'Date.now',
			example: "Друк('Час зараз: ' + Зараз());",
			question: "Друк('Час зараз: ' + Зараз());"
		},
		{
			id: 24,
			name: 'Довжина',
			execute: 'length',
			example:
				"Змінна текст = 'Привіт';\n\nДрук('Довжина: ' + текст.Довжина);",
			question:
				"Змінна текст = 'Привіт';\n\nДрук('Довжина: ' + текст.Довжина);"
		},
		{
			name: 'Індекс',
			execute: 'indexOf',
			example:
				"Змінна текст = 'Привіт, світе!';\n\nДрук('Індекс слова: ' + текст.Індекс('світе'));",
			question:
				"Змінна текст = 'Мене звати Іван';\n\nДрук('Індекс слова: ' + текст.Індекс('Іван'));",
			id: 25
		},
		{
			name: 'Замінити',
			execute: 'replace',
			example:
				"Змінна текст = 'Привіт, світе!';\n\nДрук(текст.Замінити('світе', 'друже'));",
			question:
				"Змінна текст = 'Мене звати Іван';\n\nДрук(текст.Замінити('Іван', 'Оля'));",
			id: 26
		},
		{
			name: 'Обєднати',
			execute: 'concat',
			example:
				"Змінна а = 'Привіт';\nЗмінна б = 'Світ';\n\nДрук(а.Обєднати(' ', б));",
			question:
				"Змінна а = 'Мене звати';\nЗмінна б = 'Оля';\n\nДрук(а.Обєднати(' ', б));",
			id: 27
		},
		{
			id: 28,
			name: 'Великими',
			execute: 'toUpperCase',
			example:
				"Змінна імя = 'Оля';\n\nДрук('Великими: ' + імя.Великими());",
			question:
				"Змінна імя = 'Іван';\n\nДрук('Великими: ' + імя.Великими());"
		},
		{
			id: 29,
			name: 'Малими',
			execute: 'toLowerCase',
			example: "Змінна імя = 'Оля';\n\nДрук('Малими: ' + імя.Малими());",
			question: "Змінна імя = 'Іван';\n\nДрук('Малими: ' + імя.Малими());"
		},
		{
			id: 30,
			name: 'ЦілеЧисло',
			execute: 'parseInt',
			example: "Друк('ЦілеЧисло: ' + ЦілеЧисло('42'));",
			question: "Друк('ЦілеЧисло: ' + ЦілеЧисло('21'));"
		},
		{
			name: 'Тип',
			execute: 'typeof',
			example: "Змінна вік = 25;\n\nДрук('Тип: ' + Тип(вік));",
			question: "Змінна імя = 'Іван';\n\nДрук('Тип: ' + Тип(імя));",
			id: 31
		},
		{
			id: 32,
			name: 'Число',
			execute: 'parseFloat',
			example: "Друк('Число: ' + Число('3.14'));",
			question: "Друк('Число: ' + Число('2.71'));"
		},
		{
			name: 'ЧиМасив',
			execute: 'Array.isArray',
			example:
				"Змінна список = Масив;\n\nДрук('Це масив? ' + ЧиМасив(список));",
			question:
				"Змінна текст = 'Привіт';\n\nДрук('Це масив? ' + ЧиМасив(текст));",
			id: 33
		},
		{
			id: 34,
			name: 'Масив',
			execute: '[]',
			example:
				"Змінна список = Масив;\n\nДрук('Довжина Масива: ' + список.Довжина);",
			question:
				"Змінна список = Масив;\n\nДрук('Довжина Масива: ' + список.Довжина);"
		},
		{
			id: 35,
			name: 'Додати',
			execute: 'push',
			example:
				"Змінна список = Масив;\n\nсписок.Додати('яблуко');\n\nсписок.Додати('банан');\n\nДрук('Масив: ' + список);\n\nДрук('Після видалення: ' + список);\n\nДрук('Довжина Масива: ' + список.Довжина);",
			question:
				"Змінна список = Масив;\n\nсписок.Додати('груша');\n\nсписок.Додати('банан');\n\nДрук('Масив: ' + список);\n\nДрук('Після видалення: ' + список);\n\nДрук('Довжина Масива: ' + список.Довжина);"
		},
		{
			name: 'Фільтрувати',
			execute: 'filter',
			example:
				'Змінна числа = [1, 2, 3, 4, 5];\nЗмінна парні = числа.Фільтрувати((н) => н % 2 === 0);\n\nДрук(парні);',
			question:
				'Змінна числа = [6, 7, 8, 9];\nЗмінна парні = числа.Фільтрувати((н) => н % 2 === 0);\n\nДрук(парні);',
			id: 36
		},
		{
			name: 'Мапувати',
			execute: 'map',
			example:
				'Змінна числа = [1, 2, 3];\nчисла = числа.Мапувати((н) => н * 2);\n\nДрук(числа);',
			question:
				'Змінна числа = [4, 5];\nчисла = числа.Мапувати((н) => н * 2);\n\nДрук(числа);',
			id: 37
		},
		{
			id: 38,
			name: 'ВидалитиОстанній',
			execute: 'pop',
			example:
				"Змінна список = Масив;\n\nсписок.Додати('яблуко');\n\nсписок.Додати('банан');\n\nДрук('Масив: ' + список);\n\nсписок.ВидалитиОстанній();\n\nДрук('Після видалення: ' + список.Довжина);\n\nДрук('Довжина Масива: ' + список.Довжина);",
			question:
				"Змінна список = Масив;\n\nсписок.Додати('груша');\n\nсписок.Додати('банан');\n\nДрук('Масив: ' + список);\n\nсписок.ВидалитиОстанній();\n\nДрук('Після видалення: ' + список.Довжина);\n\nДрук('Довжина Масива: ' + список.Довжина);"
		},
		{
			id: 39,
			name: 'Обєкт',
			execute: '{}',
			example:
				"Змінна учень = Обєкт;\n\nучень.імя = 'Оля';\n\nучень.вік = 10;\n\nДрук('Обєкт: ' + учень);",
			question:
				"Змінна учень = Обєкт;\n\nучень.імя = 'Іван';\n\nучень.вік = 10;\n\nДрук('Обєкт: ' + учень);"
		},
		{
			id: 40,
			name: 'Ключі',
			execute: 'Object.keys',
			example:
				"Змінна учень = Обєкт;\n\nучень.імя = 'Оля';\n\nучень.вік = 10;\n\nДрук('Ключі: ' + Ключі(учень));;",
			question:
				"Змінна учень = Обєкт;\n\nучень.імя = 'Іван';\n\nучень.вік = 10;\n\nДрук('Ключі: ' + Ключі(учень));;"
		},
		{
			id: 41,
			name: 'Значення',
			execute: 'Object.values',
			example:
				"Змінна учень = Обєкт;\n\nучень.імя = 'Оля';\n\nучень.вік = 10;\n\nДрук('Значення: ' + Значення(учень));",
			question:
				"Змінна учень = Обєкт;\n\nучень.імя = 'Іван';\n\nучень.вік = 10;\n\nДрук('Значення: ' + Значення(учень));"
		},
		{
			id: 42,
			name: 'Пари',
			execute: 'Object.entries',
			example:
				"Змінна учень = Обєкт;\n\nучень.імя = 'Оля';\n\nучень.вік = 10;\n\nДрук('Пари: ' + Пари(учень));",
			question:
				"Змінна учень = Обєкт;\n\nучень.імя = 'Іван';\n\nучень.вік = 10;\n\nДрук('Пари: ' + Пари(учень));"
		},
		{
			id: 43,
			name: 'ЄКлюч',
			execute: 'in',
			example:
				"Змінна дані = Обєкт;\n\nдані.місто = 'Київ';\n\nЯкщо ('місто' ЄКлюч дані) {\n  Друк('Місто знайдено: ' + дані.місто);\n}\n\nДрук('Після видалення: ' + дані);",
			question:
				"Змінна дані = Обєкт;\n\nдані.місто = 'Львів';\n\nЯкщо ('місто' ЄКлюч дані) {\n  Друк('Місто знайдено: ' + дані.місто);\n}\n\nДрук('Після видалення: ' + дані);"
		},
		{
			id: 44,
			name: 'Видалити',
			execute: 'delete',
			example:
				"Змінна дані = Обєкт;\n\nдані.місто = 'Київ';\n\nВидалити дані.місто;\n\nДрук('Після видалення: ' + дані);",
			question:
				"Змінна дані = Обєкт;\n\nдані.місто = 'Львів';\n\nВидалити дані.місто;\n\nДрук('Після видалення: ' + дані);"
		}
	];
}
