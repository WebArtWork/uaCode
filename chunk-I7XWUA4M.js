import{a as O}from"./chunk-RIMNUKFJ.js";import{a as U}from"./chunk-SDPCKNEL.js";import{A as r,B as o,Ba as N,C as a,D as _,Fa as H,H as x,I as z,J as s,O as m,P as S,Q as I,Z as k,_ as T,b as y,c as w,f as h,g as f,ga as M,k as F,ka as j,m as n,oa as P,p as u,q as E,qa as V,r as Q,s as d,sa as D,va as L,xa as $,za as A}from"./chunk-EPBCWZJQ.js";import{a as v,b as q,g as b}from"./chunk-GAL4ENT6.js";var G=(()=>{let e=class e extends V{constructor(){super({name:"uacodequizparticipation"})}};e.\u0275fac=function(c){return new(c||e)},e.\u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function K(i,e){if(i&1){let t=x();o(0,"div",2),z("click",function(){h(t);let c=s();return f(c.mutate())}),m(1,` \u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u043A\u0432\u0456\u0437
`),a()}}function X(i,e){if(i&1&&(o(0,"div",5),_(1,"div",6),a()),i&2){let t=s(2);n(),r("innerHtml",t.quiz.description,F)}}function Y(i,e){if(i&1){let t=x();o(0,"winput",15),z("wChange",function(c){h(t);let l=s().$implicit,C=s(3);return f(C.updateGrade(l,c))}),a()}if(i&2){let t=s().$implicit;r("value",t.grade)}}function Z(i,e){if(i&1&&(o(0,"span"),m(1),a()),i&2){let t=s().$implicit;n(),I(" (",t.grade,")")}}function ii(i,e){if(i&1){let t=x();o(0,"i",16),z("click",function(){h(t);let c=s().$implicit,l=s(3);return f(l.loadParticipant(c))}),m(1,"play_circle"),a()}}function ei(i,e){if(i&1&&(o(0,"div",9)(1,"div",10)(2,"div",11)(3,"span",10),m(4),o(5,"b"),m(6),a()()(),o(7,"div",12)(8,"span"),m(9,"\u041E\u0446\u0456\u043D\u043A\u0430:"),a(),d(10,Y,1,1,"winput",13)(11,Z,2,1,"span",1),a()(),d(12,ii,2,0,"i",14),a()),i&2){let t=e.$implicit,p=e.index,c=s(3);n(4),I("",p+1,". "),n(2),S(t.name),n(4),r("ngIf",c.classService.mineClass),n(),r("ngIf",!c.classService.mineClass&&t.grade),n(),r("ngIf",c.classService.mineClass)}}function ti(i,e){if(i&1&&(o(0,"div")(1,"div",7),m(2,"\u0423\u0447\u0430\u0441\u043D\u0438\u043A\u0438"),a(),o(3,"div",5),d(4,ei,13,5,"div",8),a()()),i&2){let t=s(2);n(4),r("ngForOf",t.participations)}}function ni(i,e){if(i&1&&(o(0,"div",5)(1,"div"),m(2,"\u0423\u0447\u0430\u0441\u043D\u0438\u043A: "),o(3,"b"),m(4),a()(),o(5,"small"),m(6,"\u041A\u043E\u0434:"),a(),_(7,"winput",17),o(8,"small"),m(9,"\u0420\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442:"),a(),_(10,"winput",18),a()),i&2){let t=s(2);n(4),S(t.participation.name),n(3),r("value",t.participation.code)("disabled",!0),n(3),r("value",t.output)("disabled",!0)}}function ai(i,e){if(i&1&&(o(0,"div",19),_(1,"wform",20),a()),i&2){let t=s(2);n(),r("config",t.participateForm)("submition",t.submition)}}function oi(i,e){if(i&1&&(o(0,"div"),d(1,X,2,1,"div",3)(2,ti,5,1,"div",1)(3,ni,11,5,"div",3)(4,ai,2,2,"div",4),a()),i&2){let t=s();n(),r("ngIf",t.quiz==null?null:t.quiz.description),n(),r("ngIf",t.participations.length),n(),r("ngIf",t.classService.mineClass&&t.participation),n(),r("ngIf",!t.classService.mineClass)}}var R=(()=>{let _QuizComponent=class _QuizComponent{constructor(i,e,t,p,c,l,C,W){this._participationService=i,this.classService=e,this._quizService=t,this._commandService=p,this._socket=c,this._core=l,this._form=C,this._router=W,this.quizId=this._router.url.replace("/quiz/",""),this.quiz=this._quizService.doc(this.quizId),this.loaded=!1,this.participations=[],this.submition={name:localStorage.getItem("myname")||"",code:""},this.participateForm=this._form.getForm("docForm",{formId:"docForm",title:"\u0424\u043E\u0440\u043C\u0430 \u0434\u043B\u044F \u0443\u0447\u0430\u0441\u0442\u0456",components:[{name:"Text",key:"name",fields:[{name:"Placeholder",value:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0456\u043C'\u044F..."},{name:"Label",value:"\u0406\u043C'\u044F"}]},{name:"Text",key:"code",fields:[{name:"Placeholder",value:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0432\u0430\u0448 \u043A\u043E\u0434..."},{name:"Label",value:"\u041A\u043E\u0434"},{name:"Textarea",value:!0}]},{name:"Button",fields:[{name:"Label",value:"\u041D\u0430\u0434\u0456\u0441\u043B\u0430\u0442\u0438"},{name:"Submit",value:!0},{name:"Click",value:()=>{this._updateParticipation()}}]}]}),this.output="",this._quizMutateForm=this._form.getForm("quizCreationForm",{formId:"quizCreationForm",title:"\u0424\u043E\u0440\u043C\u0430 \u0441\u0442\u0432\u043E\u0440\u0435\u043D\u043D\u044F \u0432\u0456\u043A\u0442\u043E\u0440\u0438\u043D\u0438",components:[{name:"Select",key:"quiz",fields:[{name:"Placeholder",value:"\u041E\u0431\u0435\u0440\u0456\u0442\u044C \u0433\u043E\u0442\u043E\u0432\u0443 \u0432\u0456\u043A\u0442\u043E\u0440\u0438\u043D\u0443"},{name:"Label",value:"\u0413\u043E\u0442\u043E\u0432\u0430 \u0432\u0456\u043A\u0442\u043E\u0440\u0438\u043D\u0430"},{name:"Items",value:this._commandService.commands.map(g=>g.quiz)},{name:"Clearable",value:!0}]},{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u043D\u0430\u0437\u0432\u0443 \u0432\u0456\u043A\u0442\u043E\u0440\u0438\u043D\u0438..."},{name:"Label",value:"\u041D\u0430\u0437\u0432\u0430 \u0432\u0456\u043A\u0442\u043E\u0440\u0438\u043D\u0438"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0437\u0430\u0432\u0434\u0430\u043D\u043D\u044F \u0432\u0456\u043A\u0442\u043E\u0440\u0438\u043D\u0438..."},{name:"Label",value:"\u0417\u0430\u0432\u0434\u0430\u043D\u043D\u044F \u0432\u0456\u043A\u0442\u043E\u0440\u0438\u043D\u0438"}]}]}),this._load(),this._socket.on("uacodequiz",g=>{g===this.quizId&&(this._load(),this._participating&&this.loadParticipant())}),this._core.onComplete("uacodeclass_loaded").then(()=>{this.classService.mineClass||this._loadMine(),this.loaded=!0})}mutate(){this._quizMutateForm.components[1].hidden=!1,this._quizMutateForm.components[2].hidden=!1,this._form.modal(this._quizMutateForm,{label:"\u0421\u0442\u0432\u043E\u0440\u0438\u0442\u0438",click:(i,e)=>b(this,null,function*(){e();let t=i;t.quiz?this._core.copy({name:"\u0417\u0430\u0432\u0434\u0430\u043D\u043D\u044F \u0432\u0456\u043A\u0442\u043E\u0440\u0438\u043D\u0438 \xAB"+this._commandService.commands[this._commandService.commands.findIndex(p=>p.quiz===t.quiz)].name+"\xBB",description:t.quiz},this.quiz):this._core.copy(i,this.quiz),this._quizService.update(this.quiz)})},this.quiz,i=>{this._quizMutateForm.components[1].hidden=!!i.quiz,this._quizMutateForm.components[2].hidden=!!i.quiz})}updateQuiz(i,e){this.quiz[i]=e,this._core.afterWhile(()=>{this._quizService.update(this.quiz)})}updateGrade(i,e){i.grade=e,this._core.afterWhile(()=>{this._participationService.update(i,{name:"owner"})})}loadParticipant(part=this._participating){this._participating=part,this._participationService.fetch(part,{name:"owner"}).subscribe(participation=>{this.output="";let print=i=>{this.output+=i+`
`};try{let code=`(()=>{${this._commandService.translate(participation.code)}})()`;eval(code)}catch(i){this.output="\u041F\u043E\u043C\u0438\u043B\u043A\u0430 \u0432 \u043A\u043E\u0434\u0456: "+this._commandService.translateErrorMessage(i.message)}this.participation=participation})}_updateParticipation(){localStorage.setItem("myname",this.submition.name||"");let i=q(v({},this.submition),{quiz:this.quizId,device:this._core.deviceID});this.participation?this._participationService.update(v(v({},this.participation),i)).subscribe(()=>{let e=this.participations.find(t=>t.device===this._core.deviceID);e&&(e.name=i.name)}):this._participationService.create(i).subscribe(e=>{this.participation=e,this._load()})}_loadMine(){this._participationService.fetch({device:this._core.deviceID,quiz:this.quizId}).subscribe(i=>{i&&(this.participation=i,this.submition.name=this.participation.name,this.submition.code=this.participation.code)})}_load(){this._participationService.get({query:"quiz="+this.quizId}).subscribe(i=>{this.participations=i})}};_QuizComponent.\u0275fac=function(e){return new(e||_QuizComponent)(u(G),u(N),u(O),u(U),u(D),u(P),u(A),u(M))},_QuizComponent.\u0275cmp=E({type:_QuizComponent,selectors:[["ng-component"]],standalone:!1,decls:2,vars:2,consts:[["class","w-btn mb15",3,"click",4,"ngIf"],[4,"ngIf"],[1,"w-btn","mb15",3,"click"],["class","code-item",4,"ngIf"],["class","group-item _code",4,"ngIf"],[1,"code-item"],[3,"innerHtml"],[1,"fw500"],["class","member-item",4,"ngFor","ngForOf"],[1,"member-item"],[1,"fg-1"],[1,"d-f","ai-c"],[1,"d-f","ai-c","gap10"],["style","width: 60px",3,"value","wChange",4,"ngIf"],["class","material-icons cl-green",3,"click",4,"ngIf"],[2,"width","60px",3,"wChange","value"],[1,"material-icons","cl-green",3,"click"],["type","textarea","placeholder","code",3,"value","disabled"],["type","textarea","placeholder","output",3,"value","disabled"],[1,"group-item","_code"],[3,"config","submition"]],template:function(e,t){e&1&&d(0,K,2,0,"div",0)(1,oi,5,4,"div",1),e&2&&(r("ngIf",t.classService.mineClass),n(),r("ngIf",t.loaded))},dependencies:[k,T,L,$],encapsulation:2});let QuizComponent=_QuizComponent;return QuizComponent})();var ri=[{path:":_id",component:R}],qi=(()=>{let e=class e{};e.\u0275fac=function(c){return new(c||e)},e.\u0275mod=Q({type:e}),e.\u0275inj=w({imports:[j.forChild(ri),H]});let i=e;return i})();export{qi as QuizModule};
