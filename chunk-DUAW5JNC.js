import{a as W,b as X}from"./chunk-2WDD3W7I.js";import{a as Q}from"./chunk-SDPCKNEL.js";import{A as x,B as a,Ba as H,C as o,Ca as J,D as A,Ea as K,Fa as O,H as L,I as v,J as l,O as s,P as _,Q as I,R as V,T as $,c as y,e as g,f,g as S,ga as M,ha as q,ka as B,la as P,m as c,na as U,oa as R,p as u,q as F,r as j,sa as N,v as d,w as h,x as w,xa as z,y as C,z as b,za as G}from"./chunk-EPBCWZJQ.js";import{a as k,b as D}from"./chunk-GAL4ENT6.js";var ae=(t,e)=>e._id;function re(t,e){if(t&1&&(a(0,"span"),s(1),o()),t&2){let m=l().$implicit;c(),I(" - ",m.points)}}function se(t,e){if(t&1&&(a(0,"div",8)(1,"div")(2,"span"),s(3),o(),d(4,re,2,1,"span"),o()()),t&2){let m=e.$implicit,i=e.$index;c(3),V("",i+1,". ",m.name," "),c(),h(m.points?4:-1)}}function ce(t,e){if(t&1&&(a(0,"div")(1,"div",7),s(2,"\u0423\u0447\u0430\u0441\u043D\u0438\u043A\u0438"),o(),a(3,"div",3),C(4,se,5,3,"div",8,ae),o()()),t&2){let m=l();c(4),b(m.participations)}}function me(t,e){if(t&1&&(a(0,"li"),s(1),o()),t&2){let m=e.$implicit;c(),_(m)}}function ue(t,e){if(t&1){let m=L();a(0,"wbutton",9),v("click",function(){f(m);let r=l();return S(r.runTournament())}),s(1,"\u0417\u0430\u043F\u0443\u0441\u0442\u0438\u0442\u0438 \u0422\u0443\u0440\u043D\u0456\u0440"),o(),a(2,"wbutton",10),v("click",function(){f(m);let r=l();return S(r.completeTournament())}),s(3,"\u0417\u0430\u043A\u0456\u043D\u0447\u0438\u0442\u0438 \u0422\u0443\u0440\u043D\u0456\u0440"),o()}}var T=(()=>{let e=class e{get options(){return this._tournamentService.options[this.method]}constructor(i,r,n,E,Y,Z,ee,te,ie,ne){this._participationService=i,this._tournamentService=r,this.classService=n,this._commandService=E,this._socket=Y,this._clipboard=Z,this._alert=ee,this._core=te,this._form=ie,this._router=ne,this.userService=g(K),this.isClass=this._router.url.split("/")[2]==="class",this.method=this._router.url.split("/")[3].split("%20").join(" "),this.name=this._tournamentService.nameTranslation,this.variables=this._tournamentService.availableVariables,this.samples=this._tournamentService.codeSamples,this.participations=[],this.submition={name:localStorage.getItem("myname")||"",code:""},this.participateForm=this._form.getForm("docForm",{formId:"docForm",title:"\u0424\u043E\u0440\u043C\u0430 \u0434\u043B\u044F \u0443\u0447\u0430\u0441\u0442\u0456",components:[{name:"Text",key:"name",fields:[{name:"Placeholder",value:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0456\u043C'\u044F..."},{name:"Label",value:"\u0406\u043C'\u044F"}]},{name:"Text",key:"code",fields:[{name:"Placeholder",value:"\u0412\u0432\u0435\u0434\u0456\u0442\u044C \u0432\u0430\u0448 \u043A\u043E\u0434..."},{name:"Label",value:"\u041A\u043E\u0434"},{name:"Textarea",value:!0}]},{name:"Button",fields:[{name:"Label",value:"\u041F\u0440\u0438\u0454\u0434\u043D\u0430\u0442\u0438\u0441\u044F"},{name:"Submit",value:!0},{name:"Click",value:()=>{this._updateParticipation()}}]}]}),this._loadMine(),this._load(),this._socket.on("uacodetournament",p=>{console.log(p),p.method===this.method&&(!this.isClass&&!p.class||p.class===this.classService.classId)&&this._load()})}copySample(){this._clipboard.copy(this.samples[this.method]),this._alert.info({unique:"copy",text:"\u0421\u043A\u043E\u043F\u0456\u0439\u043E\u0432\u0430\u043D\u043E"})}_updateParticipation(){localStorage.setItem("myname",this.submition.name||""),this._tournamentService.scriptLogicVerification[this.method](this._commandService.translate(this.submition.code))?this.participation?(this._core.copy(this.submition,this.participation),this._participationService.update(this.participation).subscribe(()=>{let i=this.participations.find(r=>r.device===this._core.deviceID);i&&(i.name=this.participation.name)})):this._participationService.create(D(k({},this.submition),{class:this.isClass?this.classService.classId:null,method:this.method,device:this._core.deviceID})).subscribe(()=>{this._load()}):this._alert.error({unique:"copy",text:"\u0412\u0430\u0448 \u043A\u043E\u0434 \u043D\u0435 \u043F\u043E\u0432\u0435\u0440\u0442\u0430\u0454 \u043F\u043E\u0442\u0440\u0456\u0431\u043D\u0456 \u0432\u0430\u0440\u0456\u0430\u043D\u0442\u0438"})}_loadMine(){this._participationService.fetch(this.isClass?{device:this._core.deviceID,method:this.method,class:this.classService.classId}:{device:this._core.deviceID,method:this.method}).subscribe(i=>{i&&(this.participation=i,this.submition.name=this.participation.name,this.submition.code=this.participation.code)})}_load(){this._participationService.get({query:`method=${this.method}`+(this.isClass?"&class="+this.classService.classId:"")},{name:"public"}).subscribe(i=>{i.sort((r,n)=>n.points-r.points),this.participations=i})}runTournament(i=!1){this._tournamentService.runTournament(this.method,this.participations,this.isClass?{device:this._core.deviceID,method:this.method,class:this.classService.classId,complete:i}:{method:this.method,complete:i})}completeTournament(){this._alert.question({text:"\u0412\u0438 \u0433\u043E\u0442\u043E\u0432\u0456 \u0437\u0430\u043A\u0440\u0438\u0442\u0438 \u0446\u0435\u0439 \u0442\u0443\u0440\u043D\u0456\u0440?",buttons:[{text:"\u041D\u0456"},{text:"\u0422\u0430\u043A",callback:()=>{this.runTournament(!0)}}]})}};e.\u0275fac=function(r){return new(r||e)(u(W),u(X),u(H),u(Q),u(N),u(J),u(U),u(R),u(G),u(M))},e.\u0275cmp=F({type:e,selectors:[["ng-component"]],standalone:!1,decls:28,vars:10,consts:[[1,"c-item","mb15",3,"routerLink"],[1,"material-icons","cl-main-d"],[1,"mb15"],[1,"code-item"],[2,"position","relative"],[1,"material-icons",2,"position","absolute","top","0","right","0",3,"click"],[1,"group-item","mb15",3,"config","submition"],[1,"fw500"],[1,"member-item"],[1,"mb15",3,"click"],[3,"click"]],template:function(r,n){r&1&&(a(0,"a",0)(1,"div"),s(2,"\u0414\u043E\u0441\u044F\u0433\u043D\u0435\u043D\u043D\u044F"),o(),a(3,"i",1),s(4,"emoji_events"),o()(),a(5,"div"),d(6,ce,6,0,"div"),a(7,"h1",2),s(8),o(),a(9,"div",3)(10,"h3"),s(11,"\u0414\u043E\u0441\u0442\u0443\u043F\u043D\u0456 \u0437\u043C\u0456\u043D\u0438"),o(),a(12,"pre"),s(13),o(),a(14,"h3"),s(15,"\u0412\u0430\u0440\u0456\u0430\u043D\u0442\u0438 \u0432\u0438\u043A\u043E\u043D\u0430\u043D\u043D\u044F \u0432\u0430\u0448\u043E\u0433\u043E \u043A\u043E\u0434\u0443"),o(),a(16,"ul"),C(17,me,2,1,"li",null,w),o(),a(19,"div",4)(20,"h3"),s(21,"\u0411\u0430\u0437\u043E\u0432\u0438\u0439 \u043F\u0440\u0438\u043A\u043B\u0430\u0434 \u043A\u043E\u0434\u0443"),o(),a(22,"i",5),v("click",function(){return n.copySample()}),s(23,"content_copy"),o()(),a(24,"pre"),s(25),o()(),A(26,"wform",6),d(27,ue,4,0),o()),r&2&&(x("routerLink",$("/achievements/",n.isClass?"class":"public","/",n.method)),c(6),h(n.participations.length?6:-1),c(2),I("\u0422\u0443\u0440\u043D\u0456\u0440: ",n.name[n.method]),c(5),_(n.variables[n.method]),c(4),b(n.options),c(8),_(n.samples[n.method]),c(),x("config",n.participateForm)("submition",n.submition),c(),h((n.isClass?n.classService.mineClass:n.userService.role("admin"))?27:-1))},dependencies:[q,P,z],encapsulation:2});let t=e;return t})();var le=[{path:"class/:_method",component:T},{path:"public/:_method",component:T}],je=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=j({type:e}),e.\u0275inj=y({imports:[B.forChild(le),O]});let t=e;return t})();export{je as TournamentModule};
